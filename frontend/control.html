<!DOCTYPE html>
<html>
<head>
    <title>더보기</title>
    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="./static/more.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./static/goto.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            function test(){
                const token = localStorage.getItem('token');
            if (token) {
                console.log("토큰 확인 완료.");

                fetch(`http://127.0.0.1:8000/user/users/me?token=${token}`, {
                    method: "GET"
                }).then(response => response.json())
                .then(data => {
                    if (data.detail) {
                        alert("오류: " + data.detail);
                    } else {
                        console.log("사용자 정보:", data);
                        const userList = document.getElementById('user-list');
                        const listItem = document.createElement('li');
                        listItem.textContent = `${data.user_name}`;
                        userList.appendChild(listItem);
                    }
                })
                .catch(error => {
                    console.error("오류 발생:", error);
                    alert("요청을 보내는 중 오류가 발생했습니다.");
                });
            } else {
                alert('로그인 정보가 없습니다. 로그인 창으로 이동합니다.');
                window.location.href = '/';
                console.log(response);
            }}
            
            test();
        });

    </script>

    <!-- <script>
      document.addEventListener('DOMContentLoaded', function() {
          fetch('http://127.0.0.1:8000/api/users')
              .then(response => response.json())
              .then(data => {
                  const userList = document.getElementById('user-list');
                  data.forEach(user => {
                      const listItem = document.createElement('li');
                      listItem.textContent = `${user.id} , ${user.email} ,${user.password}`;
                      userList.appendChild(listItem);
                  });
              });
      });
  </script> -->
</head>
<body>
   <header>
    Bit4Coin
    <img src="./static/img/setting.png" alt="" id="img_setting" onclick="goTo('setting')">
   </header>
   <main>
    <!-- 개인정보 띄워주기 -->
    <ul id="user-list"></ul>
    <!-- 개인정보 변경 버튼 -->


    <!-- 버튼 누르면 숨겨놨던 Form 창 나오기 -->
     <button onclick='document.getElementById("change").style.display ="block";'>보이기</button>
     <Form id="change" style="display: none;">
      <p>개인정보 변경란</p>
      <button type="submit">제출</button>
     </Form>
    <!-- submit-제출 후 mypage로 복귀 -->
   </main>
<!-- 이미지 -->
   <footer>
    <img src="./static/img/arrow.png" alt="" onclick="goTo('goto')">
    <img src="./static/img/symbols.png" alt="" onclick="goTo('symbols_info')">
    <img src="./static/img/home.png" alt="" onclick="goTo('home')">
    <img src="./static/img/history.png" alt="" onclick="goTo('history')">
    <img src="./static/img/more1.png" alt="" onclick="goTo('mypage')">
   </footer>
</body>

</html>